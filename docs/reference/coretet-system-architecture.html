<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoreTet System Architecture</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        svg {
            width: 100%;
            height: auto;
        }
        
        .section-title {
            font-weight: bold;
            font-size: 14px;
            fill: #333;
        }
        
        .service-box {
            fill: white;
            stroke: #4a5568;
            stroke-width: 2;
            rx: 8;
        }
        
        .user-box {
            fill: #e6fffa;
            stroke: #00897b;
            stroke-width: 2;
            rx: 8;
        }
        
        .storage-box {
            fill: #fef5e6;
            stroke: #f57c00;
            stroke-width: 2;
            rx: 8;
        }
        
        .auth-box {
            fill: #fce4ec;
            stroke: #c2185b;
            stroke-width: 2;
            rx: 8;
        }
        
        .database-box {
            fill: #e8f5e9;
            stroke: #388e3c;
            stroke-width: 2;
            rx: 8;
        }
        
        .payment-box {
            fill: #f3e5f5;
            stroke: #7b1fa2;
            stroke-width: 2;
            rx: 8;
        }
        
        .arrow {
            stroke: #4a5568;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .flow-arrow {
            stroke: #2196f3;
            stroke-width: 2;
            fill: none;
            marker-end: url(#flow-arrowhead);
            stroke-dasharray: 5,5;
        }
        
        .realtime-arrow {
            stroke: #4caf50;
            stroke-width: 2;
            fill: none;
            marker-end: url(#realtime-arrowhead);
        }
        
        .label {
            font-size: 12px;
            fill: #555;
        }
        
        .box-label {
            font-size: 13px;
            font-weight: 600;
            fill: #333;
        }
        
        .legend {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-box {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CoreTet System Architecture</h1>
        <p class="subtitle">Complete Integration Flow & Infrastructure</p>
        
        <svg viewBox="0 0 1200 900" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#4a5568"/>
                </marker>
                <marker id="flow-arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#2196f3"/>
                </marker>
                <marker id="realtime-arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#4caf50"/>
                </marker>
            </defs>
            
            <!-- User Layer -->
            <text x="50" y="30" class="section-title">USER LAYER</text>
            
            <!-- iOS App -->
            <rect x="50" y="50" width="140" height="80" class="user-box"/>
            <text x="120" y="85" text-anchor="middle" class="box-label">iOS App</text>
            <text x="120" y="105" text-anchor="middle" class="label">React Native</text>
            
            <!-- Android App -->
            <rect x="210" y="50" width="140" height="80" class="user-box"/>
            <text x="280" y="85" text-anchor="middle" class="box-label">Android App</text>
            <text x="280" y="105" text-anchor="middle" class="label">React Native</text>
            
            <!-- Desktop App -->
            <rect x="370" y="50" width="140" height="80" class="user-box"/>
            <text x="440" y="85" text-anchor="middle" class="box-label">Desktop App</text>
            <text x="440" y="105" text-anchor="middle" class="label">(Future Phase)</text>
            
            <!-- Authentication Flow -->
            <text x="50" y="180" class="section-title">AUTHENTICATION FLOW</text>
            
            <!-- Phone Auth -->
            <rect x="50" y="200" width="200" height="100" class="auth-box"/>
            <text x="150" y="230" text-anchor="middle" class="box-label">Phone Authentication</text>
            <text x="150" y="250" text-anchor="middle" class="label">1. User enters phone</text>
            <text x="150" y="270" text-anchor="middle" class="label">2. SMS code via Twilio</text>
            <text x="150" y="290" text-anchor="middle" class="label">3. Verify & create session</text>
            
            <!-- Invitation System -->
            <rect x="270" y="200" width="240" height="100" class="auth-box"/>
            <text x="390" y="230" text-anchor="middle" class="box-label">Invitation System</text>
            <text x="390" y="250" text-anchor="middle" class="label">1. Add phone to ensemble_members</text>
            <text x="390" y="270" text-anchor="middle" class="label">2. Send SMS invite link</text>
            <text x="390" y="290" text-anchor="middle" class="label">3. Auto-join on verification</text>
            
            <!-- Backend Services -->
            <text x="50" y="350" class="section-title">BACKEND SERVICES</text>
            
            <!-- Supabase -->
            <rect x="50" y="370" width="460" height="140" class="service-box"/>
            <text x="280" y="400" text-anchor="middle" class="box-label" style="font-size: 16px;">SUPABASE</text>
            
            <!-- Supabase components -->
            <rect x="70" y="420" width="100" height="70" class="database-box"/>
            <text x="120" y="445" text-anchor="middle" class="label">PostgreSQL</text>
            <text x="120" y="465" text-anchor="middle" class="label" style="font-size: 10px;">• users</text>
            <text x="120" y="480" text-anchor="middle" class="label" style="font-size: 10px;">• ensembles</text>
            
            <rect x="190" y="420" width="100" height="70" class="database-box"/>
            <text x="240" y="445" text-anchor="middle" class="label">Row Level</text>
            <text x="240" y="465" text-anchor="middle" class="label">Security</text>
            
            <rect x="310" y="420" width="80" height="70" class="database-box"/>
            <text x="350" y="445" text-anchor="middle" class="label">Realtime</text>
            <text x="350" y="465" text-anchor="middle" class="label">Subscriptions</text>
            
            <rect x="410" y="420" width="80" height="70" class="database-box"/>
            <text x="450" y="445" text-anchor="middle" class="label">Auth</text>
            <text x="450" y="465" text-anchor="middle" class="label">Service</text>
            
            <!-- Storage Services -->
            <text x="550" y="350" class="section-title">STORAGE</text>
            
            <!-- Backblaze B2 -->
            <rect x="550" y="370" width="180" height="140" class="storage-box"/>
            <text x="640" y="400" text-anchor="middle" class="box-label">Backblaze B2</text>
            <text x="640" y="425" text-anchor="middle" class="label">Audio File Storage</text>
            <text x="640" y="445" text-anchor="middle" class="label" style="font-size: 11px;">• Direct upload URLs</text>
            <text x="640" y="465" text-anchor="middle" class="label" style="font-size: 11px;">• Streaming support</text>
            <text x="640" y="485" text-anchor="middle" class="label" style="font-size: 11px;">• $6/TB/month</text>
            
            <!-- External Services -->
            <text x="770" y="350" class="section-title">EXTERNAL SERVICES</text>
            
            <!-- Twilio -->
            <rect x="770" y="370" width="140" height="60" class="service-box"/>
            <text x="840" y="400" text-anchor="middle" class="box-label">Twilio</text>
            <text x="840" y="420" text-anchor="middle" class="label">SMS Service</text>
            
            <!-- RevenueCat -->
            <rect x="770" y="450" width="140" height="60" class="payment-box"/>
            <text x="840" y="480" text-anchor="middle" class="box-label">RevenueCat</text>
            <text x="840" y="500" text-anchor="middle" class="label">Subscriptions</text>
            
            <!-- Cloud Storage -->
            <rect x="930" y="370" width="140" height="140" class="storage-box"/>
            <text x="1000" y="400" text-anchor="middle" class="box-label">Cloud Storage</text>
            <text x="1000" y="425" text-anchor="middle" class="label">Integrations:</text>
            <text x="1000" y="445" text-anchor="middle" class="label" style="font-size: 11px;">• Google Drive</text>
            <text x="1000" y="465" text-anchor="middle" class="label" style="font-size: 11px;">• Dropbox</text>
            <text x="1000" y="485" text-anchor="middle" class="label" style="font-size: 11px;">• iCloud</text>
            
            <!-- Data Flow Section -->
            <text x="50" y="560" class="section-title">KEY DATA FLOWS</text>
            
            <!-- Upload Flow -->
            <rect x="50" y="580" width="320" height="120" class="service-box" fill="#e3f2fd"/>
            <text x="210" y="605" text-anchor="middle" class="box-label">Audio Upload Flow</text>
            <text x="60" y="630" class="label">1. Select audio from device/cloud</text>
            <text x="60" y="650" class="label">2. Get presigned URL from Supabase</text>
            <text x="60" y="670" class="label">3. Direct upload to Backblaze B2</text>
            <text x="60" y="690" class="label">4. Store metadata in PostgreSQL</text>
            
            <!-- Comment Flow -->
            <rect x="390" y="580" width="320" height="120" class="service-box" fill="#e8f5e9"/>
            <text x="550" y="605" text-anchor="middle" class="box-label">Real-time Comment Flow</text>
            <text x="400" y="630" class="label">1. User adds comment at timestamp</text>
            <text x="400" y="650" class="label">2. Store in PostgreSQL</text>
            <text x="400" y="670" class="label">3. Broadcast via Realtime</text>
            <text x="400" y="690" class="label">4. Update all connected clients</text>
            
            <!-- Playback Flow -->
            <rect x="730" y="580" width="320" height="120" class="service-box" fill="#fff3e0"/>
            <text x="890" y="605" text-anchor="middle" class="box-label">Audio Playback Flow</text>
            <text x="740" y="630" class="label">1. Request track from Supabase</text>
            <text x="740" y="650" class="label">2. Generate secure streaming URL</text>
            <text x="740" y="670" class="label">3. Stream from Backblaze B2</text>
            <text x="740" y="690" class="label">4. Display comments at timestamps</text>
            
            <!-- Security Layer -->
            <text x="50" y="750" class="section-title">SECURITY & ACCESS CONTROL</text>
            
            <rect x="50" y="770" width="1000" height="80" class="service-box" fill="#fce4ec"/>
            <text x="550" y="800" text-anchor="middle" class="box-label">Row Level Security (RLS) Policies</text>
            <text x="200" y="825" class="label">• Users can only access ensembles they're members of</text>
            <text x="600" y="825" class="label">• Phone verification required for all actions</text>
            <text x="200" y="845" class="label">• Ensemble isolation enforced at database level</text>
            <text x="600" y="845" class="label">• Secure presigned URLs expire after upload</text>
            
            <!-- Connection Arrows -->
            <!-- Apps to Supabase -->
            <path d="M 120 130 L 120 370" class="arrow"/>
            <path d="M 280 130 L 280 370" class="arrow"/>
            <path d="M 440 130 L 440 370" class="arrow"/>
            
            <!-- Phone Auth connections -->
            <path d="M 150 300 L 450 420" class="flow-arrow"/>
            <text x="300" y="355" class="label" style="font-size: 10px;">verify</text>
            
            <!-- Invitation to Auth -->
            <path d="M 390 300 L 450 420" class="flow-arrow"/>
            
            <!-- Supabase to Backblaze -->
            <path d="M 510 440 L 550 440" class="arrow"/>
            <text x="525" y="435" class="label" style="font-size: 10px;">presigned URLs</text>
            
            <!-- Supabase to Twilio -->
            <path d="M 510 400 L 770 400" class="arrow"/>
            <text x="640" y="395" class="label" style="font-size: 10px;">SMS requests</text>
            
            <!-- Apps to RevenueCat -->
            <path d="M 200 130 L 200 160 L 750 160 L 750 480 L 770 480" class="flow-arrow"/>
            
            <!-- Realtime connections -->
            <path d="M 350 490 L 350 580" class="realtime-arrow"/>
            <text x="355" y="535" class="label" style="font-size: 10px;">realtime</text>
            
            <!-- Cloud storage to apps -->
            <path d="M 1000 370 L 1000 170 L 350 170 L 350 130" class="flow-arrow"/>
            <text x="675" y="165" class="label" style="font-size: 10px;">import audio</text>
        </svg>
        
        <div class="legend">
            <div class="legend-title">Legend</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-box" style="background: #e6fffa; border-color: #00897b;"></div>
                    <span>User Applications</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: white; border-color: #4a5568;"></div>
                    <span>Backend Services</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #e8f5e9; border-color: #388e3c;"></div>
                    <span>Database/Storage</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #fce4ec; border-color: #c2185b;"></div>
                    <span>Authentication</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #fef5e6; border-color: #f57c00;"></div>
                    <span>File Storage</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="background: #f3e5f5; border-color: #7b1fa2;"></div>
                    <span>Payment Services</span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>